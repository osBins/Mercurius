{{ define "main" -}}
<div id="titlebar">
    {{ if .Site.Params.Avatar }}
    <div id="avatar">
      <a href="{{ .Site.BaseURL }}">
        <img src="{{ relURL .Site.Params.Avatar }}" alt="{{ .Site.Title }}" />
      </a>
    </div>
    {{ end }}
    <div id="titletext">
      {{- if .IsHome -}}
      <h1 id="title"><a href="{{ .Site.BaseURL }}">{{ .Site.Title }}</a></h1>
      {{- else -}}
      <h2 id="title"><a href="{{ .Site.BaseURL }}">{{ .Site.Title }}</a></h2>
      {{- end -}}
    </div>
    <div id="title-description">
      {{- if isset .Site.Params "subtitle" -}}
      <p id="subtitle">{{ .Site.Params.Subtitle | markdownify }}</p>
      {{- end -}}
      <div id="social">
        <nav>
          <ul>
            {{- range $index, $key := .Site.Params.Social -}} {{- if $key.url }}
            <li>
              <a href="{{ relURL $key.url }}"
                ><i title="{{ $key.name }}" class="icons {{ $key.icon }}"></i
              ></a>
            </li>
            {{- else -}}
            <li>
              <a href="{{ $key.cmd }}"
                ><i title="{{ $key.name }}" class="icons {{ $key.icon }}"></i
              ></a>
            </li>
            {{- end -}} {{- end -}}
          </ul>
        </nav>
      </div>
    </div>
  </div>
{{ if eq .Site.Params.homepage true }}
{{ with .Site.GetPage "/homepage.md" }}
<div class="post">
	{{ if isset .Params "image" }}
	<div class="post-image">
			<img src="{{ relURL .Params.image }}" {{ if isset .Params "imagetext" }}alt="{{ .Params.imagetext }}"{{ end }}>
	</div>
	{{ end }}
	<div class="author">
		{{ if eq .Site.Params.listAuthor true}}
		{{ if isset .Params "author" }}
		<p>
		{{ if isset .Params "authorlink" }}
		{{ i18n "authorpretext" }} <a href="{{ relURL .Params.authorlink }}" target="_blank" rel="noopener noreferrer">{{ .Params.author }}</a>
		{{ else }}
		{{ i18n "authorpretext" }} {{ .Params.author }}
		{{ end }}
		</p>
		{{ end }}
		{{ end }}
	</div>
	<div class="post-header">
		{{ if ne .Date.Year 1 }}
		<div class="meta">
		{{ if not .Params.nodate }}
			<div class="date">
				<span class="day">{{ dateFormat "02" .Date }}</span>
				<span class="rest">{{ if $.Site.Data.month }}{{ index $.Site.Data.month (printf "%d" .Date.Month) }} {{ .Date.Year }}{{ else }}{{ dateFormat "Jan 2006" .Date }}{{ end }}</span>
			</div>
		{{ end }}
		</div>
		{{ end }}
		<div class="matter">
			<h1 class="title">{{ .Title }}</h1>
		</div>
	</div>
	<div class="markdown">
		{{ .Content }}
	</div>
	{{- if eq .Site.Params.comments.enabled true -}}
	{{- $.Scratch.Set "comments" true -}}
	{{- if and (isset .Params "type") (in .Site.Params.comments.disableOnTypes .Params.type) -}}
	{{- $.Scratch.Set "comments" false -}}
	{{- end -}}
	{{- if and (isset .Params "commentable") (eq .Params.commentable false) -}}
	{{- $.Scratch.Set "comments" false -}}
	{{- else if and (isset .Params "commentable") (eq .Params.commentable true) -}}
	{{- $.Scratch.Set "comments" true -}}
	{{- end -}}
	{{- if eq ($.Scratch.Get "comments") true -}}
	{{- partial "comments.html" . -}}
	{{- end -}}
	{{- end -}}
</div>
{{ end }}
{{ else }}
<div class="recent-posts">
	<div class="posts">
	{{ $pages := where .Site.RegularPages "Section" "in" .Site.Params.mainSections }}
	{{ $paginator := .Paginate (where $pages "Params.hidden" "ne" true) }}
	{{ range $paginator.Pages }}
		<div class="post">
			<div class="post-header">
				<div class="meta">
					<div class="date">
						<span class="day">{{ dateFormat "02" .Date }}</span>
						<span class="rest">{{ if $.Site.Data.month }}{{ index $.Site.Data.month (printf "%d" .Date.Month) }} {{ .Date.Year }}{{ else }}{{ dateFormat "Jan 2006" .Date }}{{ end }}</span>
					</div>
				</div>
				<div class="matter">
					<h3 class="title small"><a href="{{ .RelPermalink }}">{{.Title}}</a></h3>
					<div class="author">
					{{ if eq .Site.Params.listAuthor true}}
						{{ if isset .Params "author" }}
							{{ if isset .Params "authorlink" }}
								{{ i18n "authorpretext" }} <a href="{{ relURL .Params.authorlink }}" target="_blank" rel="noopener noreferrer">{{ .Params.author }}</a>
							{{ else }}
								{{ i18n "authorpretext" }} {{ .Params.author }}
							{{ end }}
						{{ end }}
					{{ end }}
					</div>
					<span class="description">
					{{ if isset .Params "description" }}
						{{ .Description }}
					{{ else }}
						{{ .Plain | htmlUnescape | safeHTML | truncate 140 }}
					{{ end }}
					</span>
				</div>
			</div>
		</div>
	{{ end }}
	{{ partial "paginator.html" . }}
	</div>
</div>
{{ end }}
{{ end }}
